<?php
/** @var \Orga\ViewModel\OrganizationViewModel[] $organizations */
$organizations = $this->organizations;
?>

<div class="page-header">
    <h1>
        <?=__('UI', 'name', 'applications')?>
    </h1>
</div>

<div class="organizationList">
    <?php foreach ($organizations as $organization) : ?>

        <div class="organization well">
            <?php if ($organization->canBeDeleted) : ?>
                <div class="pull-right">
                    <a class="deleteOrganization btn btn-small btn-warning"
                       href="orga/organization/delete?idOrganization=<?=$organization->id?>">
                        <i class="icon-trash icon-white"></i>
                        <?=__('UI', 'verb', 'delete')?>
                    </a>
                </div>
            <?php endif; ?>

            <h3>
                <a href="<?=$organization->link?>"><?=$organization->label?></a>
            </h3>

            <p>
                <strong><?=__('Orga', 'axis', 'rootAxes').__('UI', 'other', ':')?></strong>
                <?=implode(', ', $organization->rootAxesLabels)?>
            </p>

            <p>
                <strong><?=__('Orga', 'inventory', 'inventories').__('UI', 'other', ':')?></strong>
                <?=$organization->inventory?>
            </p>
        </div>

    <?php endforeach; ?>

    <?php if ($this->canCreateOrganization) : ?>
        <p>
            <?=$this->button(__('UI', 'verb', 'add'), 'plus-sign')->showPopup('addOrgaPopup')?>
        </p>
    <?php endif; ?>
</div>

<script>
    $(function() {
        $(".deleteOrganization").confirm({
            text: "<?=__('UI', 'message', 'areYouSure')?>",
            confirmButton: "<?=__('UI', 'verb', 'confirm')?>",
            cancelButton: "<?=__('UI', 'verb', 'cancel')?>",
            post: true
        });
    });
</script>

<?php
// Popup d'ajout
$popup = new UI_Popup_Static('addOrgaPopup');
$popup->title = __('Orga', 'organization', 'addPanelTitle');

$addForm = new UI_Form('addOrgaForm');
$addForm->setAction('orga/organization/add');
$addForm->setAjax(false);
$labelInput = new UI_Form_Element_Text('label');
$labelInput->setLabel(__('UI', 'name', 'label'));
$labelInput->setRequired(true);
$addForm->addElement($labelInput);

$popup->footer = $this->button(__('UI', 'verb', 'validate'), null, ['class' => 'btn-primary'])->submitForm('addOrgaForm')->__toString()
    . $this->button(__('UI', 'verb', 'cancel'))->closePopup('addOrgaPopup')->__toString();

$popup->body = $addForm->render();
$popup->display();
