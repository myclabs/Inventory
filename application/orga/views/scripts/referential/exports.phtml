<div class="page-header">
    <h1><?=___('UI', 'name', 'exports')?></h1>
</div>

<div class="row">

    <?php foreach ($this->exports as $exportRef => $exportArray) : ?>

        <div class="col-md-3 well well-sm text-center">
            <h4><?=$exportArray['label']?></h4>

            <form class="form-inline" action="orga/referential/export">
                <div class="input-prepend input-append">
                    <span class="add-on format">
                        <img alt="<?=$this->defaultFormat?>" src="images/dw/<?=$this->defaultFormat?>.png">
                    </span>

                    <input name="export" type="hidden" value="<?=$exportRef?>" class="form-control">

                    <?php if (count($this->formats) > 1) : ?>
                        <select name="format" class="input format form-control">
                            <?php foreach($this->formats as $formatRef => $formatLabel) : ?>
                                <option value="<?=$formatRef?>"><?=$formatLabel?></option>
                            <?php endforeach; ?>
                        </select>
                    <?php else : ?>
                        <input name="format" type="hidden" value="<?=$this->defaultFormat?>" class="form-control">
                    <?php endif; ?>

                    <?php if (isset($exportArray['version']) && (count($exportArray['version']) > 0)) { ?>
                        <?php if (count($this->formats) > 1) : ?>
                            <span class="add-on">
                                -
                            </span>
                        <?php endif; ?>
                        <select name="version" class="form-control">
                            <?php foreach($exportArray['version'] as $versionRef => $versionLabel) { ?>
                                <option value="<?=$versionRef?>"><?=$versionLabel?></option>
                            <?php } ?>
                        </select>
                    <?php } ?>

                    <button class="btn btn-primary" type="submit"><?=___('UI', 'verb', 'export')?></button>
                </div>
            </form>
        </div>

    <?php endforeach; ?>

</div>

<script>
    $('.format').on(
        'change',
        function() {
            var imgAddOn = $(this).parent().children('span.format').children('img');
            imgAddOn.attr('alt', $(this).val());
            imgAddOn.attr('src', 'images/dw/'+$(this).val()+'.png');
        }
    );
</script>

<div id="exportReferentialAsExcelPopup" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <p><?=___('Orga', 'analysis', 'detailedExcelExportPopup')?></p>
                <div class="progress progress-striped active">
                    <div class="progress-bar" style="width: 100%;"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-default" data-dismiss="modal"><?=___('UI', 'verb', 'close')?></button>
            </div>
        </div>
    </div>
</div>

<script>
    $("button.btn-primary[type=submit]").click(function(e) {
        $('#exportReferentialAsExcelPopup').modal();
    });
</script>
