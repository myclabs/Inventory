machine:
  php:
    version: 5.5.3

checkout:
  post:
    - |
      cat > application/configs/application.ini <<EOL
      [production]
      doctrine.default.connection.host = '127.0.0.1'
      doctrine.default.connection.dbname = 'circle_test'
      doctrine.default.connection.user = 'ubuntu'
      [test : production]
      [developpement : test]
      [testsunitaires : test]
      EOL
    - |
      cat > application/configs/parameters.php <<EOL
      <?php
      return [
          'application.url' => 'whatever',
      ];
      EOL
    - |
      cat > application/configs/env.php <<EOL
      <?php
      defined('APPLICATION_ENV') || define('APPLICATION_ENV', 'testsunitaires');
      EOL

dependencies:
  cache_directories:
    - "vendor"

database:
  override:
    - php scripts/build/build.php -e testsunitaires update
    - php scripts/build/build.php -e testsunitaires populate

test:
  override:
    - phpunit
