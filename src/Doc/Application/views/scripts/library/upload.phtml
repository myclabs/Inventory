<?php
/** @var $library Doc\Domain\Library */
$library = $this->library;
?>

<form id="addDocument<?=$library->getId()?>" class="form-horizontal" method="post" enctype="multipart/form-data"
      action="doc/library/add?id=<?=$library->getId()?>" target="upload_iframe<?=$library->getId()?>">

    <div class="form-group">
        <label class="col-sm-2 control-label">
            <?=__('Doc', 'library', 'fileAddress')?>
        </label>
        <div class="col-sm-10">
            <input name="file" type="file" class="form-control" required>
        </div>
    </div>

    <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
            <button type="submit" class="btn btn-primary">
                <?=__('UI', 'verb', 'add')?>
            </button>
        </div>
    </div>

</form>

<iframe id="upload_iframe<?=$library->getId()?>" name="upload_iframe<?=$library->getId()?>" src="#" class="hidden">
</iframe>

<div class="uploading hide alert alert-info">
    <?=$this->image('images/ui/ajax-loader.gif', '')?>
    <?=__('Doc', 'library', 'uploading')?>
</div>

<div class="uploadingErrors hide alert alert-danger"></div>

<script>

    // Début de l'upload
    $("#addDocument<?=$library->getId()?>").submit(function() {
        $("#library<?=$library->getId()?>_add .uploading").show();
        $("#library<?=$library->getId()?>_add .uploadingErrors").hide();
    });

    // Callback appelée lorsque le téléchargement a réussi
    function fileUploadResult<?=$library->getId()?>(success, message) {
        if (success) {
            $("#library<?=$library->getId()?>_add .uploading").hide();
            $("#addDocument<?=$library->getId()?>").trigger('uploadSuccess');
        } else {
            $("#library<?=$library->getId()?>_add .uploading").hide();
            $("#library<?=$library->getId()?>_add .uploadingErrors").html(message)
                .show();
        }
    }

</script>
